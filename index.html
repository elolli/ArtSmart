<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" rel="stylesheet">
    <style type="text/css">
      * {
        font-size: 11px;
      }
      .container {
        padding: 2%;
      }
      .green {
        color: #b0d28b;
      }
      .blue {
        color: #4871b6;
      }
      .purple {
        color: #966696;
      }
      img.centered {
        margin: 0 auto;
      }
      .row {
        margin-bottom: 16px;
      }
      .row.login {
        background: #e0e0e0;
        padding-bottom: 20px;
      }
      .row.game {
        background: #e0e0e0;
        margin-left: 0px;
        margin-right: 0px;
        padding-bottom: 15px;
      }
      .row.game .inner {
        background: #fff;
      }
      @media (max-width: 480px) {
        .row.game {
          background: #95cd79;
          color: #fff;
        }
        .row.game .inner {
          background: none;
        }
        .row.game .inner .row {
          background: #fff;
        }
        .row.game .inner .green {
          color: #fff;
        }
      }
      .btn-social {
        border: none;
        margin-bottom: 8px;
      }
      .btn-social i {
        width: 18px;
      }
      .btn-facebook {
        background-color: #38609D;
      }
      .btn-twitter {
        background-color: #53A5DB;
      }
      .btn-google {
        background-color: #E8383C;
      }
      .artwork {
        position: relative;
        margin-bottom: 30px;
      }
      .artwork::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -20px;
        width: 0;
        height: 0;
        border-top: solid 20px #fff;
        border-left: solid 20px transparent;
        border-right: solid 20px transparent;
      }
      .artwork h2 {
        padding-top: 12px;
      }
      .artwork .img-responsive {
        z-index: 999;
        margin: 5% auto;
        cursor: pointer;
        filter: gray;
        padding: 16px;
        -webkit-filter: grayscale(100%);
      }
      .hunt .padded {
        background: #e0e0e0;
        padding: 24px;
        overflow: hidden;
      }
      .hunt .padded .inner {
        background: #fff;
      }
      .hunt .padded .inner .list {
        background: #F0F1F0;
      }
      .hunt .padded .inner .list p {
        color: #966696;
        margin-top: 6px;
        font-size: 16px;
      }
      .hunt .padded .inner #map-canvas {
        height: 400px;
        margin: 0;
        padding: 0;
      }
      .hunt .padded .inner .location {
        font-size: 16px;
        padding: 16px 0;
        border-top: 2px solid #666;
      }
      .hunt .padded .inner .location:last-child {
        border-bottom: 2px solid #666;
      }
      .hunt .padded .inner .location i {
        font-size: 24px;
        vertical-align: middle;
        margin-right: 12px;
      }
      .clues .clue p {
        color: #000;
        border: 1px solid black;
        text-align: center;
        padding: 16px;
        box-sizing: border-box;
      }
      .clues .clue p span {
        display: block;
        position: relative;
        top: 50%;
        transform: translateY(-50%);
        font-size: 10px;
      }
      .clues .clue p,
      .clues .clue .img-responsive {
        margin: 5% auto;
        height: 90px;
        width: 90px;
      }
      @media only screen and (max-width:480px){
        .artwork .img-responsive {
          padding: 0;
          height: 103px;
          width: 103px;
        }
        .clues .clue p,
        .clues .clue .img-responsive {
          height: 103px;
          width: 103px;
        }
      }
      @media only screen and (min-width:481px) and (max-width:768px){
        .artwork .img-responsive {
          padding: 0;
          height: 124px;
          width: 124px;
        }
        .clues .clue p,
        .clues .clue .img-responsive {
          height: 124px;
          width: 124px;
        }
      }
      @media only screen and (min-width:769px) and (max-width:991px){
        .artwork .img-responsive {
          padding: 0;
          height: 103px;
          width: 103px;
        }
        .clues .clue p,
        .clues .clue .img-responsive {
          height: 103px;
          width: 103px;
        }
      }
      @media only screen and (min-width:992px){
        .artwork .img-responsive {
          padding: 0;
          height: 110px;
          width: 110px;
        }
        .clues .clue p,
        .clues .clue .img-responsive {
          height: 110px;
          width: 110px;
        }
      }
      .map h2 {
        padding-top: 12px;
      }
      .map #map-canvas {
        height: auto;
        min-height: 480px;
        margin: 0;
        padding: 0;
      }
      #modal-map .modal-content {
        text-align: center;
        padding: 16px;
      }
      #modal-map .modal-content h2 {
        margin-bottom: 0;
      }
      #modal-map .modal-content h3 {
        margin-top: 0;
        margin-bottom: 16px;
      }
      #modal-map .modal-content button {
        position: absolute;
        top: 16px;
        right: 16px;
        background: none;
        border: none;
      }
      #modal-map .modal-content button .hide {
        display: none;
      }
      #modal-map .modal-content a {
        color: #b0d28b;
      }
      #modal-map .modal-content a.btn {
        color: #fff;
        background-color: #b0d28b;
        border-color: #78AE72;
      }
      #modal-map .modal-content a.btn strong {
        font-size: 14px;
      }
      #modal-map .modal-content p {
        margin-top: 12px;
      }
      #modal-map .modal-content p a {
        font-size: 12px;
        font-weight: bold;
      }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <h2 class="green">Jackson Art Smart</h2>
          <p>Calling all kids and adults! Looking for some fun around Jackson? Want to learn <strong>AND</strong> have fun, too? Check out Art Smart. Split up in teams and see who can finish first or challenge each other in funny poses. Whatever the stakes, you're sure to have a fun day exploring hidden treasures around town!</p>
          <img class="img-responsive centered" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/infographic.jpg" />
        </div>
      </div>
      <div class="row login">
        <div class="col-xs-12">
          <h1 class="text-center">Login to start!</h1>
          <div class="col-xs-12 col-sm-4 col-sm-offset-4">
            <button class="btn btn-primary btn-lg btn-block btn-social btn-facebook" onclick="hello('facebook').login()"><i class="fa fa-facebook"></i> <strong>Sign In with</strong> Facebook</button>
            <button class="btn btn-primary btn-lg btn-block btn-social btn-twitter" onclick="hello('twitter').login()"><i class="fa fa-twitter"></i> <strong>Sign In with</strong> Twitter</button>
            <button class="btn btn-primary btn-lg btn-block btn-social btn-google" onclick="hello('google').login()"><i class="fa fa-google-plus"></i> <strong>Sign In with</strong> Google+</button>
          </div>
        </div>
      </div>
      <div class="row game hide">
        <div class="col-xs-12 col-sm-7">
          <div class="inner artwork">
            <h2 class="text-center green">Get Started!</h2>
            <p class="text-center green">Drag and drop the 6 photos to the corresponding clues!</p>
            <div class="row">
              <div class="col-xs-4">
                <img class="img-responsive" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/RealityTV.jpg" data-num="1" data-lat="42.2141389" data-long="-084.4171111" data-title="Reality TV" />
              </div>
              <div class="col-xs-4">
                <img class="img-responsive" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/DefofFlag.jpg" data-num="2" data-lat="42.2475833" data-long="-084.4146111" data-title="Defense of the Flag" />
              </div>
              <div class="col-xs-4">
                <img class="img-responsive" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/SummerNightTree.jpg" data-num="3" data-lat="42.2475833" data-long="-084.4040000" data-title="Summer Night Tree" />
              </div>
              <div class="col-xs-4">
                <img class="img-responsive" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/ConsumersMural.jpg" data-num="4" data-lat="42.2479444" data-long="-084.4095556" data-title="Consumers Mural" />
              </div>
              <div class="col-xs-4">
                <img class="img-responsive" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/CascadeFalls.jpg" data-num="5" data-lat="42.2295556" data-long="-084.4329722" data-title="Cascade Falls" />
              </div>
              <div class="col-xs-4">
                <img class="img-responsive" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/BevSimmonsBunny.jpg" data-num="6" data-lat="42.21514" data-long="-84.41595" data-title="Bev Simmons Bunny" />
              </div>
            </div>
          </div>
          <div class="inner clues">
            <div class="row">
              <div class="clue col-xs-4" data-num="5">
                <p><span>Six fountains, three reflecting pools, 90 LED rope lights and music</span></p>
              </div>
              <div class="clue col-xs-4" data-num="1">
                <p><span>Showcased in the first annual Outdoor Sculpture Exhibit at Ella Sharp Museum</span></p>
              </div>
              <div class="clue col-xs-4" data-num="6">
                <p><span>Artist was inspired after Beverly Simmons passed away</span></p>
              </div>
              <div class="clue col-xs-4" data-num="3">
                <p><span>One of the first public sculpture in the mid-west</span></p>
              </div>
              <div class="clue col-xs-4" data-num="2">
                <p><span>Memorial to 3282 Michigan volunteer infantry regiments in Civil War</span></p>
              </div>
              <div class="clue col-xs-4" data-num="4">
                <p><span>Newest piece of public art to reopen</span></p>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-5 hidden-xs">
          <div class="inner map">
            <h2 class="text-center blue">ArtFinder Map</h2>
            <p class="text-center blue">Watch as the map is revealed!</p>
            <div id="map-canvas"></div>
          </div>
        </div>
      </div>
      <div class="row hunt hide">
        <h2 class="purple">Scavenger Hunt</h2>
        <p>Visit all 6 art pieces, take photos of each art piece, come back to upload and share them, and get your art finder certificate!</p>
        <div class="padded">
          <div class="inner">
            <div class="col-sm-7" id="map-hunt"></div>
            <div class="col-sm-5 list">
              <p>Now, you’re prepared to set out on your scavenger hunt excursion!</p>
              <div class="location">
                <i class="fa fa-map-marker"></i> Summer Night Tree
                <a href="https://www.google.com/maps/dir/Current+Location/42.2475833,-084.4040000" target="_blank" class="pull-right"><i class="fa fa-car"></i></a>
              </div>
              <div class="location">
                <i class="fa fa-map-marker"></i> Consumer Energy Mural
                <a href="https://www.google.com/maps/dir/Current+Location/42.2479444,-084.4095556" target="_blank" class="pull-right"><i class="fa fa-car"></i></a>
              </div>
              <div class="location">
                <i class="fa fa-map-marker"></i> The Cascades
                <a href="https://www.google.com/maps/dir/Current+Location/42.2295556,-084.4329722" target="_blank" class="pull-right"><i class="fa fa-car"></i></a>
              </div>
              <div class="location">
                <i class="fa fa-map-marker"></i> Defense of the Flag
                <a href="https://www.google.com/maps/dir/Current+Location/42.2475833,-084.4146111" target="_blank" class="pull-right"><i class="fa fa-car"></i></a>
              </div>
              <div class="location">
                <i class="fa fa-map-marker"></i> Bev Simmons Bunny
                <a href="https://www.google.com/maps/dir/Current+Location/42.21514,-84.41595" target="_blank" class="pull-right"><i class="fa fa-car"></i></a>
              </div>
              <div class="location">
                <i class="fa fa-map-marker"></i> Reality TV
                <a href="https://www.google.com/maps/dir/Current+Location/42.2141389,-084.4171111" target="_blank" class="pull-right"><i class="fa fa-car"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <p>Acknowledgement to The Arts and Cultural Alliance together with University of Michigan School of Information, as inspired by Jackson 2020, to get recognition.</p>
        </div>
      </div>
    </div>

    <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mapModal" aria-hidden="true" id="modal-map">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <button type="button" title="Close" id="modal-corner-close">
            <i class="fa fa-close"></i>
            <span class="hide">Close</span>
          </button>
          <h2>Congratulations!</h2>
          <h3>You've unlocked the map!</h3>
          <a class="btn btn-primary" href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/PDF_final.pdf" target="_blank"><i class="fa fa-download"></i> Download <strong>Map</strong></a>
          <p>
            <a href="#" id="modalDismiss">Start scavenger hunt <i class="fa fa-arrow-circle-right"></i></a>
          </p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/26175/hello.min.js"></script>
    <script>
      $(function() {
        hello.init({ 
          facebook : '393132174170274',
          twitter  : 'l6UCHw9kXPag2iL7iLaL8Y9n7',
          google   : '308365557297-t4bg22rjik10kilfjbf7qidbpa71miri.apps.googleusercontent.com',
          oauth_proxy : 'https://auth-server.herokuapp.com/proxy',
          scope    : 'publish, publish_files'
        });
        
        var map,
            markers = [],
            infowindows = [],
            LatLngList = [],
            numCorrect = 0,
            user = {
              network: null,
              profileId: null,
              name: null,
              picture: null
            };

        var key = "OtOAKvwFij9gLU3xBoSdwbpaVUHjrcEZ",
            db = "art-finder",
            collection = "progress";

        //DATABASE FOR LOGGING IN
        var mongoUri = "https://api.mongolab.com/api/1/databases/"+db+"/collections/"+collection+"?apiKey="+key;

        //https://api.mongolab.com/api/1/databases/art-finder/collections/progress?apiKey=OtOAKvwFij9gLU3xBoSdwbpaVUHjrcEZ
        

        function initialize() {
          var mapOptions = {
            zoom: 12,
            center: {lat: 42.2458000, lng: -84.4014000}
          };
          map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        }
        google.maps.event.addDomListener(window, 'load', initialize);

        function add_marker(opts, place) {
          var marker = new google.maps.Marker(opts);
          marker.place_id = place.id;
          markers[place.id] = marker;
          var infowindow = new google.maps.InfoWindow({
            content: place.details
          });

          infowindows[place.id] = infowindow;
          LatLngList.push(opts.position);

          google.maps.event.addListener(marker, 'click', function() {
            infowindows[marker.place_id].open(map,marker);
          });
         }
        
        function recenterMap() {
          var bounds = new google.maps.LatLngBounds ();
          for (var i = 0, LtLgLen = LatLngList.length; i < LtLgLen; i++) {
            bounds.extend (LatLngList[i]);
          }
          map.fitBounds (bounds);
        }

        function centerModal() {
            $(this).css('display', 'block');
            var $dialog = $(this).find(".modal-dialog");
            var offset = ($(window).height() - $dialog.height()) / 2;
            $dialog.css("margin-top", offset);
        }

        $('.modal').on('show.bs.modal', centerModal);
        $(window).on("resize", function () {
          $('.modal:visible').each(centerModal);
        });

        $('#modalDismiss, #modal-corner-close').click(function(e) {
          e.preventDefault();
          $('#modal-map').modal('hide');
          $('.game').addClass('hide');
          $('.hunt').removeClass('hide');
          $('#map-canvas').appendTo($('#map-hunt'));
          google.maps.event.trigger(map, 'resize');
          recenterMap();
        });

        $(".artwork .img-responsive")
          .draggable({ revert: 'invalid' });
        $(".clues p")
          .droppable({
            accept: ".artwork .img-responsive",
            activeClass: "ui-state-hover",
            hoverClass: "ui-state-active",
            drop: function(event, ui) {
              var art = $(ui.draggable),
                  accepted = $(this).parent().data('num');
              if(art.data('num') == accepted){
                var parent = $(this).parent();
                parent.empty();
                art.appendTo(parent).removeClass('ui-draggable').removeAttr('style');
                add_marker({
                  position: new google.maps.LatLng(art.data('lat'), art.data('long')),
                  title: art.data('title'),
                  map: map
                }, {
                  id: art.data('num'),
                  details: art.data('title')
                });
                var data = {'user': user.network + '_' + user.profileId, 'solved': art.data('title')};
                saveProgress(data);
                numCorrect++;
                if(numCorrect == 6){
                  var modalOptions = {
                    backdrop: 'static',
                    keyboard: false
                  }
                  $('#modal-map').modal(modalOptions);
                }
              } else {
                art.draggable('option','revert',true);
              }
            }
          });

        hello.on('auth.login', function(auth){
          hello( auth.network ).api( '/me' ).then( function(r){
            user.network = auth.network;
            user.profileId = r.id;
            user.name = r.name;
            user.picture = r.picture;
            resumeGame();
            $('.login').addClass('hide');
            $('.game').removeClass('hide');
          });
        });

        function saveProgress(data) {
          $.ajax({
            url: mongoUri,
            type: "POST",
            data: JSON.stringify(data),
            contentType: "application/json"
          }).done(function( msg ) {
            console.log(msg);
          });
        }

        function resumeGame() {
          var query = { 'user' : user.network + '_' + user.profileId };

          $.ajax({
            url: mongoUri,
            type: "GET",
            data: "q=" + JSON.stringify(query),
            contentType: "application/json"
          }).done(function( msg ) {
            for(var i = 0; i < msg.length; i++) {
              var art = $('.artwork img[data-title="'+msg[i].solved+'"]');
              var num = art.data('num');
              var clue = $('.clue[data-num="'+num+'"]');
              
              clue.empty().append(art).removeClass('ui-draggable').removeAttr('style');
              add_marker({
                position: new google.maps.LatLng(art.data('lat'), art.data('long')),
                title: art.data('title'),
                map: map
              }, {
                id: art.data('num'),
                details: art.data('title')
              });
              numCorrect++;
              if(numCorrect == 6){
                var modalOptions = {
                  backdrop: 'static',
                  keyboard: false
                }
                $('#modal-map').modal(modalOptions);
              }
            }
          });
        }
      });
    </script>
  </body>
</html>
